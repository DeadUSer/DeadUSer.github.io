<!DOCTYPE html>

<html>
<link rel="stylesheet" crossorigin="anonymous"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T">

<body class="bg-dark text-light">
    <div class="container">
        <div class="row w-100">
            <div class="col-md-8 order-md-1 ">

                <h4 class="m-2">Калькулятор шлангов</h4>
                <input id="txt_amount" type="number" max="200" class="form-control m-2"
                    placeholder="Введите количество шлангов" value="10">
                <div class="m-2 w-100">
                    <button type="button" class="btn btn-light" onclick="addInputs()">Сгенерировать</button>
                    <button type="button" class="btn btn-light" onclick="removeInputs()">Отчистить</button>
                </div>

                <div id="inputs" class="m-2"></div>
                <button type="button" class="btn btn-light m-2 w-100" onclick="calculate()">Посчитать</button>
                <div class="progress ml-2 w-100">
                    <div id="bar_progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"
                        aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <h4 id="result" class="m-2" style="color:red"></h4>
            </div>
            <div class="col-md-4 order-md-2">
                <div class="m-2">
                    <p class="">
                        <br>максимум шлангов: 20
                        <br>длина бобины: 200
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    removeInputs();

    function removeInputs() {
        document.getElementById('inputs').innerHTML = '';
        current = 0;
        tubes = [];
        combinations = [];
        bundleLength = 200;
        max = 20;
        showProgress(0, 100);
    }

    function addInput() {
        if (current < max) {
            document.getElementById('inputs').innerHTML +=
                '<input type="number" max="200" class="form-control m-1 tube" placeholder="Введите длину шланга">';
            current++;
        }
    }

    function addInputs() {
        var howMach = document.getElementById('txt_amount').value;
        for (var i = 0; i < howMach; i++) addInput();
    }

    function showProgress(cur, all) {
        var percent = (cur / all) * 100;
        var progress = document.getElementById('bar_progress');
        progress.style.width = percent + '%';
    }

    function calculate() {
        var elements = document.getElementsByClassName('tube');
        showProgress(1, 100);

        for (var i = 0; i < elements.length; i++) {
            tubes.push({
                id: String(i),
                weight: elements[i].value,
                previous: String(),
                sumWeight: 0,
            })
        }

        buildTree();
        calculateCombinations();

        showProgress(100, 100);
    }

    function buildTree(prevTube) {
        if (!prevTube) {
            prevTube = {
                id: "root",
                weight: 0,
                previous: "",
                sumWeight: 0,
            }
        }

        debugger;
        for (var i = 0; i < tubes.length; i++) {
            newTube = tubes[i];
            if (_.findIndex(prevTube.previous, function (o) { return o == newTube.id; }) !== -1) { return; }
            else {
                newTube.sumWeight = prevTube.sumWeight + newTube.weight;
                if (newTube.sumWeight = 200) {
                    newTube.previous = prevTube.previous + newTube.id;
                    combinations.push({
                        way: newTube.previous, weight: newTube.sumWeight
                    })
                    return;
                }
                else if (newTube.sumWeight > 200) {
                    combinations.push({
                        way: prevTube.previous, weight: prevTube.sumWeight
                    });
                    return;
                }
                else if (newTube.sumWeight < 200) {
                    newTube.previous = prevTube.previous + newTube.id;
                    newTube.sumWeight = prevTube.sumWeight + newTube.wight;
                }
            }

            buildTree(newTube);
        }
    }
</script>

</html>